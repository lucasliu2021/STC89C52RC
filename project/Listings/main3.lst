C51 COMPILER V9.60.0.0   MAIN3                                                             12/06/2021 22:03:48 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN3
OBJECT MODULE PLACED IN .\Objects\main3.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE src\main3.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings
                    -\main3.lst) TABS(2) OBJECT(.\Objects\main3.obj)

line level    source

   1          #include <reg52.h>
   2          #define uchar unsigned char
   3          void Timer0_Init();          // PWMæ³¢å®šæ—¶å™¨
   4          void Timer1_Init();          //ä¸²å£
   5          void Timer2_Init();          //è¶…æ—¶æ£€æµ‹å®šæ—¶
   6          void make();                 //æ•°æ®å¤„ç†
   7          void resettime();            //è¶…æ—¶æ£€æµ‹
   8          void send();                 //å“åº”ä¿¡æ¯
   9          sfr T2MOD = 0xC9;            //å®šæ—¶å™¨2å¯„å­˜å™¨åœ°å€
  10          sbit LED6 = P0 ^ 6;                   //æ•°æ®ç¯
  11          sbit LED7 = P0 ^ 7;                   //è®¡æ—¶ç¯
  12          uchar level[2][6] = {0X00}, mesg[6];  //å ç©ºæ¯”level+åè®®å˜é‡mesg
  13          uchar code Fback[2][8] = {"SUCCED!", "ERROR!"};
  14          uchar time, a;
  15          static bit uart_flag, error_flag,model_flag = 0,x = 0;  //ä½¿ç”¨ä½å˜é‡èŠ‚çœç©ºé—´,æ¨¡å¼é»˜è®¤ä¸º0æ™®é
             -€š4led,xä½œä¸ºäº®åº¦çº§åˆ«è¡Œæ•°ï¼Œ0è¡Œæ™®é€š4LEDï¼Œ1è¡Œ8LEDæµæ°´ç¯,
  16          static uchar count;  //ä¸²å£æ¥æ”¶è®¡æ•°çš„é™æ€å˜é‡åˆå§‹å€¼ä¸º0
  17          //ä¸»å‡½æ•°
  18          void main() {
  19   1          Timer0_Init();
  20   1          Timer1_Init();
  21   1          Timer2_Init();
  22   1          while (1) {
  23   2              send();
  24   2              //if (model_flag == 1) {
  25   2                  //Breath_Light();  //å¼€å¯æµæ°´ç¯
  26   2              //}
  27   2          }
  28   1      }
  29          //å®šæ—¶å™¨0ä¸­æ–­å›ºå®šè„‰å®½PWMè¾“å‡º
  30          void Timer0() interrupt 1 {
  31   1          TR0 = 0;  //èµ‹åˆå€¼æ—¶ï¼Œå…³é—­å®šæ—¶å™¨
  32   1          TH0 = 0XFF;
  33   1          TL0 = 0Xb8;
  34   1          TR0 = 1;  //æ‰“å¼€å®šæ—¶å™¨
  35   1          time++;
  36   1          //å ç©ºæ¯”light
  37   1        if(time < level[x][1])
  38   1              P0=0XFF;
  39   1          //æ¸…é›¶time
  40   1          if (time == 0xFF) {
  41   2              time = 0x00;
  42   2          }
  43   1      }
  44          
  45          //ä¸²å£ä¸­æ–­ï¼Œå…ˆæ¥æ”¶8ä¸ªå­—èŠ‚è‡³mesgæ•°ç»„ä¿å­˜ï¼Œæœ€ååœ¨ä¸»å‡½æ•°å¤„ç†æ•°æ®
  46          void UART_SER() interrupt 4 {
  47   1          RI = 0;  //æ‰‹åŠ¨æ¸…å¯„å­˜å™¨ï¼ˆæ•°æ®æ¥æ”¶å®Œæˆè‡ªåŠ¨ç½®1ï¼‰
  48   1          mesg[count] = SBUF;
  49   1          //åŒæ—¶åˆ¤æ–­countè·Ÿæ”¶åˆ°çš„æ•°æ®
  50   1          if (count == 0 && mesg[count] == 0xAA) {
  51   2              count = 1;
  52   2          } else if (count == 1) {
  53   2              count = 2;
C51 COMPILER V9.60.0.0   MAIN3                                                             12/06/2021 22:03:48 PAGE 2   

  54   2          } else if (count == 2) {
  55   2              count = 3;
  56   2          } else if (count == 3) {
  57   2              count = 4;
  58   2          } else if (count == 4) {
  59   2              count = 5;
  60   2          } else if (count == 5 && mesg[count] == 0x55)  //æ£€éªŒå›ºå®šçš„å¸§å°¾
  61   1          {
  62   2              count = 0;
  63   2              uart_flag = 1;  //ä¸²å£æ¥æ”¶æˆåŠŸæ ‡å¿—ï¼Œä¸º1æ—¶åœ¨ä¸»ç¨‹åºä¸­å›å¤ï¼Œç„¶åæ¸…é›¶
  64   2              ES = 0;  //å…³ä¸­æ–­ï¼Œå›å¤å®Œäº†å†ES=1;
  65   2          } else {
  66   2              count = 0;       //åˆ¤æ–­ä¸æ»¡è¶³æ¡ä»¶å°±å°†è®¡æ•°å€¼æ¸…é›¶
  67   2              error_flag = 1;  //å¤´æ•°æ®ä¸é€šè¿‡
  68   2          }
  69   1          LED6 = ~LED6;
  70   1          resettime();  //è¿›å…¥ç›‘æ§
  71   1      }
  72          //è¶…æ—¶ä¸­æ–­50ms*400==20s
  73          void T2_Time() interrupt 5 {
  74   1          static unsigned short run;
  75   1          TF2 = 0;  //æ‰‹åŠ¨æ ‡å¿—ä½æ¸…é›¶
  76   1          LED7 = 0;
  77   1          run++;
  78   1          if (run == 400) {
  79   2              if (uart_flag != 1) {
  80   3                  error_flag = 1;  //æ—¶é—´åˆ°æœªå®Œæ•´ä¼ è¾“ï¼Œå‘é€å¤±è´¥æç¤º
  81   3              }
  82   2              count = 0;  //æ¸…é›¶
  83   2              LED7 = 1;   //å…³é—­çŠ¶æ€æŒ‡ç¤ºç¯
  84   2              LED6 = 1;   //å…³é—­æ•°æ®ä¼ è¾“ç¯
  85   2              run = 0;
  86   2              TR2 = 0;  //åªè¦è®¡æ—¶åˆ°å…³é—­ç›‘æ§ï¼Œç­‰å¾…resettime()ä¸‹ä¸€æ¬¡å¼€å¯
  87   2          }
  88   1      }
  89          //å®šæ—¶å™¨0åˆå§‹åŒ–
  90          void Timer0_Init() {
  91   1          TMOD |= 0x01;  //å®šæ—¶å™¨0å·¥ä½œæ–¹å¼1
  92   1          TH0 = 0XFF;
  93   1          TL0 = 0Xb8;
  94   1          ET0 = 1;  //å¼€å®šæ—¶å™¨0ä¸­æ–­
  95   1          TR0 = 1;  //å¯åŠ¨å®šæ—¶å™¨0
  96   1          EA = 1;   //å¼€æ€»ä¸­æ–­
  97   1      }
  98          //å®šæ—¶å™¨1åˆå§‹åŒ–
  99          void Timer1_Init() {
 100   1          SCON = 0x50;  // sm0sm1=01ï¼Œä¸²å£å·¥ä½œæ–¹å¼1ï¼Œ10ä½=8ä¸ºæ•°æ®+1ä½å¼€å§‹+1ä½åœæ­¢
 101   1          TMOD |= 0x20;
 102   1          TH1 = 0xfd;  //æ³¢ç‰¹ç‡9600
 103   1          TL1 = 0xfd;
 104   1          TR1 = 1;
 105   1          ES = 1;  //ä¸²å£ä½¿èƒ½
 106   1          PS = 1;  //ä¸²å£ä¸­æ–­ä¼˜å…ˆçº§
 107   1          EA = 1;
 108   1      }
 109          //å®šæ—¶å™¨2åˆå§‹åŒ–50ms
 110          void Timer2_Init() {
 111   1          T2MOD = 0;   //åˆå§‹åŒ–æ¨¡å¼å¯„å­˜å™¨
 112   1          T2CON = 0;   //åˆå§‹åŒ–æ§åˆ¶å¯„å­˜å™¨
 113   1          TH2 = 0x4C;  //è®¾ç½®å®šæ—¶åˆå§‹å€¼50ms
 114   1          TL2 = 0x00;
 115   1          RCAP2H = 0x4C;  //è®¾ç½®å®šæ—¶é‡è½½å€¼
C51 COMPILER V9.60.0.0   MAIN3                                                             12/06/2021 22:03:48 PAGE 3   

 116   1          RCAP2L = 0x00;  //è®¾ç½®å®šæ—¶é‡è½½å€¼
 117   1          TR2 = 0;        //å®šæ—¶å™¨2é»˜è®¤å…³é—­
 118   1          ET2 = 1;        //å¼€å®šæ—¶å™¨2ä¸­æ–­
 119   1          EA = 1;
 120   1      }
 121          void send() {
 122   1          uchar i;
 123   1          //æˆåŠŸåé¦ˆ(å‘é€+å¤„ç†)
 124   1          if (uart_flag == 1) {
 125   2              ES = 0;
 126   2              for (i = 0; i < 8; i++) {
 127   3                  SBUF = Fback[0][i];
 128   3                  while (!TI)
 129   3                      ;
 130   3                  TI = 0;  //å‘é€ä¸­æ–­è¯·æ±‚æ ‡å¿—ä½
 131   3              }
 132   2              ES = 1;
 133   2              uart_flag = 0;
 134   2              make();  //å¤„ç†æ•°æ®
 135   2          }
 136   1          //å¤±è´¥åé¦ˆï¼ˆå¤´å°¾æ£€æµ‹ä¸é€šè¿‡æˆ–è€…è¶…æ—¶ï¼‰
 137   1          if (error_flag == 1) {
 138   2              ES = 0;
 139   2              for (i = 0; i < 8; i++) {
 140   3                  SBUF = Fback[1][i];
 141   3                  while (!TI)
 142   3                      ;
 143   3                  TI = 0;  //å‘é€ä¸­æ–­è¯·æ±‚æ ‡å¿—ä½
 144   3              }
 145   2              ES = 1;
 146   2              error_flag = 0;  //æ¢å¤çŠ¶æ€
 147   2          }
 148   1      }
 149          //æ•°æ®å¤„ç†ï¼ˆå ç©ºæ¯”èµ‹å€¼ï¼‰ï¼ˆæ¨¡å¼åˆ‡æ¢é æ•°æ®è§£æï¼‰
 150          void make() {
 151   1          if (mesg[1] == 0XBB & mesg[2] == 0XCC && mesg[3] == 0XDD &&
 152   1              mesg[4] == 0XEE) {
 153   2              model_flag = 1;  //å¼€å¯æµæ°´ç¯
 154   2      
 155   2          } else {
 156   2              for (a = 0; a < 4; a++) {
 157   3                  ET0 = 0;  //å…³å®šæ—¶å™¨0
 158   3                  level[0][a] = mesg[a + 1];
 159   3                  ET0 = 1;         //å¼€å®šæ—¶å™¨0
 160   3                  model_flag = 0;  //å…³é—­æµæ°´ç¯
 161   3              }
 162   2          }
 163   1      }
 164          //è¶…æ—¶å¤„ç†å¼€å¯
 165          void resettime() {
 166   1          TR2 = 0;  //å…³é—­å®šæ—¶å™¨2
 167   1          if (count != 0) {
 168   2              TR2 = 1;  //æ‰“å¼€å®šæ—¶å™¨2
 169   2          }
 170   1      }
 171          // P0å£å…«ä¸ªledç¯åŒæ—¶æ§åˆ¶å‘¼å¸ï¼Œå¾ªç¯ä¸€ä¸ªç¯é—ªçƒã€‚ï¼ˆéœ€è¦é€šä¿¡åè®®AABBCCDDEEFFï¼‰
 172          //æ»‘åŠ¨å‘¼å¸ç¯


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    530    ----
   CONSTANT SIZE    =     16    ----
C51 COMPILER V9.60.0.0   MAIN3                                                             12/06/2021 22:03:48 PAGE 4   

   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     23       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      4    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
